<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On
    RewriteBase /

    # --- 1. FORCE NO-CACHE FOR REACT UPDATES ---
    # This prevents the "Old Design" from sticking and fixes "Blank Screen" issues
    <FilesMatch "\.(html|htm|js|json)$">
        FileETag None
        <IfModule mod_headers.c>
            Header unset ETag
            Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
            Header set Pragma "no-cache"
            Header set Expires "Wed, 11 Jan 1984 05:00:00 GMT"
        </IfModule>
    </FilesMatch>

    # --- 2. CORS HEADERS (Required for API) ---
    <IfModule mod_headers.c>
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"
        Header always set Access-Control-Max-Age "1000"
        Header always set Access-Control-Allow-Headers "x-requested-with, Content-Type, origin, authorization, accept, client-security-token"
    </IfModule>

    # --- 3. CORE ROUTING ---

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Handle OPTIONS requests
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]

    # Don't touch real files or directories
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^ - [L]

    # IF REQUEST IS FOR API -> SEND TO LARAVEL (index.php)
    RewriteCond %{REQUEST_URI} ^/api [NC]
    RewriteRule ^ index.php [L]

    # IF REQUEST IS ANYTHING ELSE -> SEND TO LARAVEL (index.php)
    # This allows Laravel's web.php to handle routing and serve index.blade.php
    RewriteRule ^ index.php [L]
</IfModule>
